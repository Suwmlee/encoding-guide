<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>x264 Settings - 高级编码指南</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">介绍</a></li><li class="chapter-item expanded "><a href="../filtering/filtering.html"><strong aria-hidden="true">1.</strong> 过滤Filtering</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">1.1.</strong> 载入视频Loading the Video</div></li><li class="chapter-item expanded "><a href="../filtering/cropping.html"><strong aria-hidden="true">1.2.</strong> 裁剪Cropping</a></li><li class="chapter-item expanded "><a href="../filtering/resizing.html"><strong aria-hidden="true">1.3.</strong> 调整大小(Resizing)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../filtering/descaling.html"><strong aria-hidden="true">1.3.1.</strong> 解放缩(descaling)与重新缩放(rescaling)</a></li><li class="chapter-item expanded "><a href="../filtering/chroma_res.html"><strong aria-hidden="true">1.3.2.</strong> 色度重采样与偏移(Chroma Resampling and Shifting)</a></li></ol></li><li class="chapter-item expanded "><a href="../filtering/bit_depths.html"><strong aria-hidden="true">1.4.</strong> 位深(Bit Depths)与抖动算法(Dither Algorithms)</a></li><li class="chapter-item expanded "><a href="../filtering/debanding.html"><strong aria-hidden="true">1.5.</strong> 解带(Debanding)与解块(Deblocking)</a></li><li class="chapter-item expanded "><a href="../filtering/graining.html"><strong aria-hidden="true">1.6.</strong> 颗粒化(Graining)</a></li><li class="chapter-item expanded "><a href="../filtering/dirty_lines.html"><strong aria-hidden="true">1.7.</strong> 脏线(Dirty Lines)与边界问题(Border Issues)</a></li><li class="chapter-item expanded "><a href="../filtering/detinting.html"><strong aria-hidden="true">1.8.</strong> 除着色(Detinting)与水平调整(Level Adjustment)</a></li><li class="chapter-item expanded "><a href="../filtering/masking.html"><strong aria-hidden="true">1.9.</strong> 蒙版(Masking)</a></li><li class="chapter-item expanded "><a href="../filtering/anti-aliasing.html"><strong aria-hidden="true">1.10.</strong> 抗锯齿(Anti-Aliasing)</a></li><li class="chapter-item expanded "><a href="../filtering/deringing.html"><strong aria-hidden="true">1.11.</strong> 消除振铃(Deringing)</a></li><li class="chapter-item expanded "><a href="../filtering/dehaloing.html"><strong aria-hidden="true">1.12.</strong> 去晕(Dehaloing)</a></li><li class="chapter-item expanded "><a href="../filtering/denoising.html"><strong aria-hidden="true">1.13.</strong> 降噪(Denoising)</a></li><li class="chapter-item expanded "><a href="../filtering/dehardsubbing.html"><strong aria-hidden="true">1.14.</strong> 剔除硬字幕(Dehardsubbing)与去台标(Delogoing)</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> 编码Encoding</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../encoding/testing.html"><strong aria-hidden="true">2.1.</strong> 测试编码(Test Encodes)</a></li><li class="chapter-item expanded "><a href="../encoding/x264.html" class="active"><strong aria-hidden="true">2.2.</strong> x264 Settings</a></li><li class="chapter-item expanded "><a href="../encoding/x265.html"><strong aria-hidden="true">2.3.</strong> x265 Settings</a></li><li class="chapter-item expanded "><a href="../encoding/screenshots.html"><strong aria-hidden="true">2.4.</strong> 截图和对比(Screenshots and Comparisons)</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> 音频Audio</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> SoX: 抖动和向下混合(Dithering and Down-Mixing)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.</strong> 单声道和立体声(Mono and Stereo)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.3.</strong> 环绕声(Surround Sound)</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> 附录Appendix</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> 线性光处理(Linear Light Processing)</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> 使用FT寻找最佳分辨率</div></li><li class="chapter-item expanded "><a href="../appendix/grain_matching.html"><strong aria-hidden="true">4.3.</strong> 颗粒匹配(Grain Matching)</a></li><li class="chapter-item expanded "><a href="../appendix/gray.html"><strong aria-hidden="true">4.4.</strong> 黑白剪辑(Black &amp; White Clips)</a></li></ol></li><li class="chapter-item expanded "><a href="../scriptorium.html"><strong aria-hidden="true">5.</strong> Scriptorium</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">高级编码指南</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="general-settings"><a class="header" href="#general-settings">General settings</a></h1>
<p>These are the settings that you shouldn't touch between encodes.</p>
<h2 id="preset"><a class="header" href="#preset">Preset</a></h2>
<p>Presets apply a number of parameters, which can be referenced <a href="https://dev.beandog.org/x264_preset_reference.html">here</a>
Just use the placebo preset, we'll change the really slow stuff, anyway:</p>
<pre><code>--preset placebo
</code></pre>
<h2 id="level"><a class="header" href="#level">Level</a></h2>
<p>Where --preset applies a defined set of parameters, --level provides a set of limitations to ensure decoder compatibility. For further reading, see this <a href="https://en.wikipedia.org/wiki/Advanced_Video_Coding#Levels">wikipedia article</a></p>
<p>For general hardware support level 4.1 is recommended, otherwise you may omit this.</p>
<pre><code>--level 41
</code></pre>
<h2 id="motion-estimation"><a class="header" href="#motion-estimation">Motion estimation</a></h2>
<p>For further reading <a href="https://web.archive.org/web/20210516085632/https://forum.doom9.org/showthread.php?p=1789660">see this excellent thread on Doom9</a></p>
<p>x264 has two motion estimation algorithms worth using, umh and tesa.
The latter is a placebo option that's really, really slow, and seldom yields better results, so only use it if you don't care about encode time.
Otherwise, just default to umh:</p>
<pre><code>--me umh
</code></pre>
<h2 id="ratecontrol-lookahead"><a class="header" href="#ratecontrol-lookahead">Ratecontrol lookahead</a></h2>
<p>The ratecontrol lookahead (rc-lookahead) setting determines how far ahead the video buffer verifier (VBV) and macroblock tree (mbtree) can look.
Raising this can slightly increase memory use, but it's generally best to leave this as high as possible:</p>
<pre><code>--rc-lookahead 250
</code></pre>
<p>If you're low on memory, you can lower it to e.g. 60.</p>
<h1 id="source-specific-settings"><a class="header" href="#source-specific-settings">Source-specific settings</a></h1>
<p>These settings should be tested and/or adjusted for every encode.</p>
<h2 id="profile"><a class="header" href="#profile">Profile</a></h2>
<p>Just set this according to the format you're encoding:</p>
<pre><code>--profile high
</code></pre>
<ul>
<li><code>high</code> for 8-bit 4:2:0</li>
<li><code>high444</code> for 10-bit 4:4:4, 4:2:2, 4:2:0, lossless</li>
</ul>
<h2 id="ratecontrol"><a class="header" href="#ratecontrol">Ratecontrol</a></h2>
<p>Beyond all else, this is the single most important factor for determining the quality from any given input. Due to how poorly x264 handles lower bitrates (comparatively, particularly when encoding 8-bit) starving your encode will result in immediate artifacts observable even under the lightest scrutiny.</p>
<p>While manipulating other settings may make small, but usually noticeable differences; an encode can't look great unless given enough bits.</p>
<p>For some futher insight, reference <a href="https://github.com/jpsdr/x264/blob/master/doc/ratecontrol.txt">this article</a></p>
<h3 id="constant-ratefactor"><a class="header" href="#constant-ratefactor">Constant ratefactor</a></h3>
<p>For more information please see <a href="https://forum.doom9.org/showthread.php?p=1261917#post1261917">this post by an x264 developer</a>.</p>
<p>The constant ratefactor (CRF) is the suggested mode for encoding.
Rather than specifying a target bitrate, CRF attempts to ensure a consistent quality across a number of frames; as such, the resulting bitrate will only be consistent if passed identical values.
In short, CRF is recommended for use with your finalized encode, not testing, where two pass is recommended.</p>
<p>Lower CRF values are higher quality, higher values lower.
Some settings will have a very large effect on the bitrate at a constant CRF, so it's hard to recommend a CRF range, but most encodes will use a value between 15.0 and 20.0.
It's best to test your CRF first to find an ideal bitrate, then test it again after all other settings have been tested with 2pass.</p>
<p>To specify CRF:</p>
<pre><code>--crf 16.9
</code></pre>
<h3 id="two-pass"><a class="header" href="#two-pass">Two pass</a></h3>
<p>An alternative to CRF which leverages an initial pass to collect information about the input before encoding. This comes with two distinct advantages:</p>
<ul>
<li>The ability to target a specific bitrate</li>
<li>Effectively infinite lookahead</li>
</ul>
<p>This is very suitable for testing settings, as you will always end up at almost the same bitrate no matter what.</p>
<p>As mentioned previously, to encode this two runs are necessary. The first pass can be sent to /dev/null, since all we care about is the stats file.
To specify which of the two passes you're encoding all we need to change is <code>--pass</code></p>
<pre><code>vspipe -c y4m script.vpy - | x264 --demuxer y4m --preset placebo --pass 1 --bitrate 8500 -o /dev/null -
</code></pre>
<pre><code>vspipe -c y4m script.vpy - | x264 --demuxer y4m --preset placebo --pass 2 --bitrate 8500 -o out.h264 -
</code></pre>
<h2 id="deblock"><a class="header" href="#deblock">Deblock</a></h2>
<p>For an explanation of what deblock does, read <a href="https://forum.doom9.org/showthread.php?p=1692393#post1692393">this Doom9 post</a> and <a href="https://web.archive.org/web/20220323033558/https://huyunf.github.io/blogs/2017/11/20/h264_deblocking_algorithm/">this blog post</a></p>
<p>Set this too high and you'll have a blurry encode, set it too low and you'll have an overly blocky encode.
We recommend testing deblock in a range of <code>-2:-2</code> to <code>0:0</code> (animated content should use stronger deblock settings).
Usually, you can test this with the same alpha and beta parameters at first, then test offsets of \(\pm1\).</p>
<p>Many people will mindlessly use -3:-3, but this tends to lead to unnecessary blocking that could've been avoided had this setting been tested.</p>
<p>To specify e.g. an alpha of -2 and a beta of -1:</p>
<pre><code>--deblock -2:-1
</code></pre>
<h2 id="quantizer-curve-compression"><a class="header" href="#quantizer-curve-compression">Quantizer curve compression</a></h2>
<p>The quantizer curve compression (qcomp) is effectively the setting that determines how bits are distributed among the whole encode.
It has a range of 0 to 1, where 0 is a constant bitrate and 1 is a constant quantizer, the opposite of a constant bitrate.
This means qcomp affects how much bitrate you're giving to &quot;important&quot; scenes as opposed to &quot;unimportant&quot; scenes.
In other words, it can be seen as the trade-off between bitrate allocation to simple or static scenes and complex or high motion scenes.
Higher qcomp will allocate more to the latter, lower to the former.</p>
<p>It's usually recommended to set this between <code>0.60</code> and <code>0.70</code> without mbtree and <code>0.70</code> and <code>0.85</code> with mbtree.
You want to find that sweet spot where complex scenes will look good enough without ruining simple scenes.</p>
<pre><code>--qcomp 0.60
</code></pre>
<h2 id="macroblock-tree"><a class="header" href="#macroblock-tree">Macroblock tree</a></h2>
<p>From <a href="https://forum.doom9.org/showthread.php?t=148686">this thread by an x264 developer</a>: &quot;It tracks the propagation of information from future blocks to past blocks across motion vectors. It could be described as localizing qcomp to act on individual blocks instead of whole scenes. Thus instead of lowering quality in high-complexity scenes (like x264 currently does), it'll only lower quality on the complex part of the scene, while for example a static background will remain high-quality. It also has many other more subtle effects, some potentially negative, most probably not.&quot;</p>
<p>Curious readers can reference the <a href="https://archive.org/download/x264_mbtree/x264_mbtree.pdf">paper directly</a></p>
<p>Macroblock tree ratecontrol (mbtree) can lead to large savings for very flat content, but tends to be destructive on anything with a decent amount of grain.
If you're encoding something flat, like a cartoon or modern anime, it's recommended to test this setting to see if it's worth it.</p>
<p>When using mbtree, you should max out your lookahead (<code>--rc-lookahead 250</code>) and use a high qcomp (\(\geq 0.70\)).</p>
<h2 id="adaptive-quantization"><a class="header" href="#adaptive-quantization">Adaptive quantization</a></h2>
<p>While qcomp determines bit allocation for frames across the video, adaptive quantization (AQ) is in charge of doing this on a block-basis, distributing bits not only within the current frame, but also adjacent frames. [citation needed]
It does so by distributing bits e.g. from complex to flat blocks.</p>
<p>There are three modes available in vanilla x264:</p>
<ol>
<li>Allow AQ to redistribute bits across the whole video and within frames.</li>
<li>Auto-variance; this attempts to adapt strength per-frame.</li>
<li>Auto-variance with a bias to dark scenes.</li>
</ol>
<p>Generally speaking, you'll likely get the best results with AQ mode 3.
With the other two modes, you have to carefully make sure that darks aren't being damaged too much.
If you e.g. have a source without any dark scenes (or only very few), it can be worth manually allocating more bits to darks via <a href="#zones">zoning</a> and using AQ modes 1 or 2.</p>
<p>This comes along with a strength parameter.
For modes 1 and 2, you usually want a strength between 0.80 and 1.30.
Mode 3 is a bit more aggressive and usually looks best with a strength between 0.60 and 0.85.</p>
<p>Raising the AQ strength will help flatter areas, e.g. by maintaining smaller grain and dither to alleviate banding.
However, higher AQ strengths will tend to distort edges more.</p>
<p>Older, grainier live action content will usually benefit more from lower AQ strengths and may benefit less from the dark scene bias present in AQ mode 3, while newer live action tends to benefit more from higher values.
For animation, this setting can be very tricky; as both banding and distorted edges are more noticeable.
It's usually recommended to run a slightly lower AQ strength, e.g. around 0.60 to 0.70 with mode 3.</p>
<p>To use e.g. AQ mode 3 with strength 0.80:</p>
<pre><code>--aq-mode 3 --aq-strength 0.80
</code></pre>
<h2 id="motion-estimation-range"><a class="header" href="#motion-estimation-range">Motion estimation range</a></h2>
<p>The motion estimation range (merange) determines how many pixels are used for motion estimation.
Larger numbers will be slower, but can be more accurate for higher resolutions.
However, go too high, and the encoder will start picking up unwanted info, which in turn will harm coding efficiency.
You can usually get by with testing <code>32</code>, <code>48</code>, and <code>64</code>, then using the best looking one, preferring lower numbers if equivalent:</p>
<pre><code>--merange 32
</code></pre>
<h2 id="frametype-quantizer-ratio"><a class="header" href="#frametype-quantizer-ratio">Frametype quantizer ratio</a></h2>
<p>These settings determine how bits are distributed among the different frame types.
Generally speaking, you want to have an I-frame to P-frame ratio (ipratio) around 0.10 higher than your P-frame to B-frame ratio (pbratio).
Usually, you'll want to lower these from the defaults of <code>1.40</code> for ipratio and <code>1.30</code> for pbratio, although not by more than 20.</p>
<p>Lower ratios will tend to help with grainier content, where less information from previous frames can be used, while higher ratios will usually lead to better results with flatter content.</p>
<p>You can use the stats created by the x264 log at the end of the encoding process to check whether the encoder is overallocating bits to a certain frametype and investigate whether this is a problem.
A good guideline is for P-frames to be double the size of B-frames and I-frames in turn be double the size of P-frames.
However, don't just blindly set your ratios so that this is the case.
Always use your eyes.</p>
<p>To set an ipratio of <code>1.30</code> and a pbratio of <code>1.20</code>:</p>
<pre><code>--ipratio 1.30 --pbratio 1.20
</code></pre>
<p>If using mbtree, pbratio doesn't do anything, so only test and set ipratio.</p>
<h2 id="psychovisually-optimized-rate-distortion-optimization"><a class="header" href="#psychovisually-optimized-rate-distortion-optimization">Psychovisually optimized rate-distortion optimization</a></h2>
<p>One big issue with immature encoders is that they don't offer psychovisual optimizations like psy-rdo.
What it does is distort the frame slightly, sharpening it in the process.
This will make it statistically less similar to the original frame, but will look better and more similar to the input.
What this means is this is a weak sharpener of sorts, but a very much necessary sharpener!</p>
<p>The setting in x264 comes with two options, psy-rdo and psy-trellis, which are both set via the same option:</p>
<pre><code>--psy-rd rdo:trellis
</code></pre>
<p>Unfortunately, the latter will usually do more harm than good, so it's best left off.
The psy-rdo strength should be higher for sharper content and lower for blurrier content. For animated content, psy-rdo can introduce ringing even with default values. We suggest using lower values, between  <code>0.60</code> and <code>0.90</code>. For live action content where this is of much lesser concern you should find success with values around <code>0.95</code> to <code>1.10</code>. </p>
<p>When testing this, pay attention to whether content looks sharp enough or too sharp, as well as whether anything gets distorted during the sharpening process.</p>
<p>For example, to set a psy-rd of 1.00 and psy-trellis of 0:</p>
<pre><code>--psy-rd 1.00:0
</code></pre>
<h2 id="dct-block-decimation"><a class="header" href="#dct-block-decimation">DCT block decimation</a></h2>
<p>Disabling DCT block decimation (no-dct-decimate) is very common practice, as it drops blocks deemed unimportant.
For high quality encoding, this is often unwanted and disabling this is wise.
However, for flatter content, leaving this on can aid with compression.
Just quickly test on and off if you're encoding something flat.</p>
<p>To disable DCT block decimation:</p>
<pre><code>--no-dct-decimate
</code></pre>
<h2 id="video-buffer-verifier"><a class="header" href="#video-buffer-verifier">Video buffer verifier</a></h2>
<p>To understand what this is, there's actually a <a href="https://en.wikipedia.org/wiki/Video_buffering_verifier">Wikipedia article you can read</a>. Alternatively, you may find <a href="https://www.youtube.com/watch?v=-Q7BuSXdO_8">this video presentation</a> from demuxed informative.</p>
<p>For us, the main relevance is that we want to disable this when testing settings, as video encoded with VBV enabled will be non-deterministic.
Otherwise, just leave it at your level's defaults.</p>
<p>To disable VBV:</p>
<pre><code>--vbv-bufsize 0 --vbv-maxrate 0
</code></pre>
<p>VBV settings for general hardware compliance (High@L4.1)</p>
<pre><code>--vbv-bufsize 78125 --vbv-maxrate 62500
</code></pre>
<h2 id="reference-frames"><a class="header" href="#reference-frames">Reference frames</a></h2>
<p>The reference frames (ref) setting determines how many frames P frames can use as reference. Many existing guides may provide an incorrect formula to find the 'correct' value. <strong>Do not use this</strong>. Rather, allow x264 to calculate this for automatically (as dictated by <code>--level</code>). </p>
<p>Otherwise, if you don't care about compatibility with 15 year old TVs and 30 year old receivers, set this however high you can bare, with a maximum value of 16.
Higher refs will improve encoder efficiency at the cost of increased compute time.</p>
<p>To set the maximum value of 16:</p>
<pre><code>--ref 16
</code></pre>
<h2 id="zones"><a class="header" href="#zones">Zones</a></h2>
<p>Sometimes, the encoder might have trouble distributing enough bits to certain frames, e.g. ones with wildly different visuals or sensitive to banding.
To help with this, one can zone out these scenes and change the settings used to encode them.</p>
<p>When using this to adjust bitrate, one can specify a CRF for the zone or a bitrate multiplier.
It's very important to not bloat these zones, e.g. by trying to maintain all the grain added while debanding.
Sane values tend to be \(\pm 2\) from base CRF or bitrate multipliers between <code>0.75</code> and <code>1.5</code>.</p>
<p>To specify a CRF of 15 for frames 100 through 200 and 16 for frames 300 through 400, as well as a bitrate multiplier of 1.5 for frames 500 through 600:</p>
<pre><code>--zones 100,200,crf=15/300,400,crf=16/500,600,b=1.5
</code></pre>
<p>For a more complete picture of what --zones can and can not manipulate, see <a href="https://www.chaneru.com/Roku/HLS/X264_Settings.htm#zones">this section</a>.</p>
<h2 id="output-depth-and-color-space"><a class="header" href="#output-depth-and-color-space">Output depth and color space</a></h2>
<p>To encode 10-bit and/or 4:4:4 video, one must specify this via the following parameters:</p>
<pre><code>--output-depth 10 --output-csp i444
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../encoding/testing.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../encoding/x265.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../encoding/testing.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../encoding/x265.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
